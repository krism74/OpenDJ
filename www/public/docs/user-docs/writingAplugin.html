<!DOCTYPE html PUBLIC "-//Tigris//DTD XHTML 1.0 Transitional//EN" "http://style.tigris.org/nonav/tigris_transitional.dtd">
<html>
<head>
  <link rel="SHORTCUT ICON"
 href="https://opends.dev.java.net/public/images/opends_favicon.gif">
  <style type="text/css"> 
/* <![CDATA[ */
 @import "/branding/css/tigris.css";
 @import "/branding/css/inst.css";
 /* ]]> */
  </style>
  <link rel="stylesheet" type="text/css" href="/branding/css/print.css"
 media="print">
  <link rel="stylesheet" href="../../css/opends.css" type="text/css">
  <title>OpenDS Synchronization Configuration</title>
</head>
<body>
<table class="tertmasttable" cellspacing="0" width="100%">
  <tbody>
    <tr>
      <td>
      <div class="collectionheader">Extending OpenDS functionality with
a plugin<br>
      </div>
      </td>
      <td style="vertical-align: bottom;" width="10%"><a
 href="https://opends.dev.java.net/"><img
 src="../../images/opends_logo_sm.png" alt="OpenDS Logo" align="bottom"
 border="0" height="33" width="104"></a></td>
    </tr>
  </tbody>
</table>
<hr noshade="noshade" size="1">
<br>
While OpenDS is highly configurable and already provides multiple
capabilities out of the box, there are some deployments that require
specific constraints that cannot be handled in a generic way.<br>
<br>
For those constraints OpenDS provides several APIs to customize and
extend the Directory Server.<br>
<br>
This document describes how to write, load and activate a plugin using
the Directory Server plugin API. It is using a very small Directory
Server plugin example to illustrate its
purpose.<br>
<br>
This document is intended to help those who want to implement
additional
capabilities of Directory Server but do not know where to start.<br>
It is targeted at users already familiar with the Java language and a
Java development environment like <a href="http://java.sun.com/javase/">Java
SE</a>.<br>
<hr noshade="noshade" size="1">
<h1>What's a Directory Server plugin ?</h1>
A Plugin is used to implement some form of fringe processing that is
not essential to the operation of the Directory Server, and is invoked
at distinct, well-defined times in the life cycle of a client request.<br>
<br>
Typical types of plugins includes pre-parse, pre-operation,
post-operation and post-response plugins.<br>
Pre-parse plugins are called before the operation is parsed and can
therefore change the incoming request before they are processed by the
server.<br>
Pre-operation plugins are called before primary processing is done for
an operation and therefore have the possibility to alter the
way the operation is processed by the server.<br>
Post-operation and Post-response plugins are called after the operation
processing and therefore have the capabilities to access
all the information about the operation including its result and
possible effect on the entry. It therefore offers the possibility to
perform any additional computation after each operation is processed.
With OpenDS post-operation plugins are called before the LDAP result is
sent to the client application and can therefore
change the result of operations.<br>
Post-response are called after the LDAP response are sent to the
applications and can be used for any additional processing.<br>
<br>
The example described below implements a pre-operation plugin for the
ADD operation. OpenDS allows for many other types of plugins, and some
of
them will be briefly discussed at the end of this document.<br>
<br>
Because the goal of this document is to explain how to write and enable
a plugin, the plugin that is described will only have a very small
functionality : it will prevent additions of entries with a description
attribute that is shorter than 8 characters. The plugin will achieve
this by interposing its own code at the beginning of the operation
phase and by altering the server behavior when it detects a description
attribute shorter than 8 characters.<br>
<br>
<hr noshade="noshade" size="1">
<h1>Description of the example plugin :</h1>
The example plugin provided below is built over a
commonly-used API of
OpenDS : the DirectoryServerPlugin abstract class.<br>
This interface itself makes it possible to implement a selection
of&nbsp; several
types of plugins by overriding the method corresponding to the type of
plugin that is needed.<br>
<br>
This example only needs to alter the behavior of ADD operations and
therefore override the <span style="font-family: monospace;">PreOperationPluginResult</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
doPreOperation(PreOperationAddOperation addOperation)</span><span
 style="font-family: monospace;"> </span>method in order to implement
a pre-operation
ADD plugin.<br>
<br>
The only other method that is required by the interface is the <span
 style="font-family: monospace;">initializePlugin </span>method. This
method makes it possible to get the entry containing the configuration
of the
plugin and therefore to use configuration attributes to further
customize the behavior of a DirectoryServerPlugin. This example does
not demonstrate this and therefore the <span
 style="font-family: monospace;">initializePlugin </span>method of
this example is empty.<br>
<br>
The main part of the example code that stay below sf the code inside
the <span style="font-family: monospace;">PreOperationPluginResult</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;
doPreOperation(PreOperationAddOperation addOperation)</span><span
 style="font-family: monospace;"> </span>method.<br>
This code uses the <span style="font-family: monospace;">PreOperationAddOperation</span>
parameter to retrieve the entry that the ADD operation intends to add
in
the DirectoryServer. It then uses to entry to retrieve the description
attribute and finally check the values of this attribute.<br>
This simple example checks that all values for the description
attribute are at least
eight characters long and rejects any ADD operations that do not match
this criteria with a <span style="font-family: monospace;"><span
 style="color: rgb(0, 0, 0);">CONSTRAINT_VIOLATION</span> </span>error.<br>
<br>
The plugins control the way the server will behave after returning from
the pre-operation plugin using the returned <span
 style="font-family: monospace;">PreOperationPluginResult</span> object
: at creation time this object is created using three boolean flags :
the first one makes it possible to tell the Directory Server whether
the connection on which the operation was done has been terminated by
the plugin, the
second one makes it possible to direct the Directory Server to stop
further
processing of the request, the third makes it possible to tell the
Directory Server to send the LDAP response to the client application.<br>
In this example we use <span style="font-family: monospace;">false,
false, true</span> in order to have the server stop the processing when
any description value have is shorter than 8 characters and the
predefined static value SUCCESS when all description values are longer
than 8 characters.<br>
<br>
Full example code :<br>
<br>
<span style="font-family: monospace; color: rgb(0, 153, 0);">/*</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*
CDDL HEADER START</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*
The contents of this file are subject to the terms of the</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*
Common Development and Distribution License, Version 1.0 only</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*
(the "License").&nbsp; You may not use this file except in compliance</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*
with the License.</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*
You can obtain a copy of the license at</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*</span><span
 style="font-family: monospace; color: rgb(0, 153, 0);">
https://OpenDS.dev.java.net/OpenDS.LICENSE.</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*
See the License for the specific language governing permissions</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*
and limitations under the License.</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*
When distributing Covered Code, include this CDDL HEADER in each</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*
file and include the License file at</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*
trunk/opends/resource/legal-notices/OpenDS.LICENSE.&nbsp; If applicable,</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*
add the following below this CDDL HEADER, with the fields enclosed</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;* by
brackets "[]" replaced with your own identifying * information:</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Portions Copyright [yyyy] [name of copyright owner]</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*
CDDL HEADER END</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*</span><br
 style="font-family: monospace; color: rgb(0, 153, 0);">
<span style="font-family: monospace; color: rgb(0, 153, 0);">&nbsp;*</span><br
 style="color: rgb(0, 153, 0); font-family: monospace;">
<span style="color: rgb(0, 153, 0); font-family: monospace;">&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Portions Copyright 2006 Sun Microsystems, Inc.</span><br
 style="color: rgb(0, 153, 0); font-family: monospace;">
<span style="color: rgb(0, 153, 0); font-family: monospace;">&nbsp;*/</span><span
 style="font-family: monospace;"><br>
<span style="color: rgb(153, 0, 0);">package</span>
org.example.opends.plugins;<br>
<br>
<span style="color: rgb(153, 0, 0);">import</span> java.util.List;<br>
<span style="color: rgb(153, 0, 0);">import</span> java.util.Set;<br>
<br>
<span style="color: rgb(153, 0, 0);">import</span>
org.opends.server.api.plugin.DirectoryServerPlugin;<br>
<span style="color: rgb(153, 0, 0);">import</span>
org.opends.server.api.plugin.PreOperationPluginResult;<br>
<span style="color: rgb(153, 0, 0);">import</span>
org.opends.server.config.ConfigEntry;<br>
</span><span style="font-family: monospace;"><span
 style="color: rgb(153, 0, 0);">import</span> </span><span
 style="font-family: monospace;">org.opends.server.config.ConfigException;<br>
</span><span style="font-family: monospace;"><span
 style="color: rgb(153, 0, 0);">import</span> </span><span
 style="font-family: monospace;">org.opends.server.types.AttributeValue;<br>
</span><span style="font-family: monospace;"><span
 style="color: rgb(153, 0, 0);">import</span> </span><span
 style="font-family: monospace;">org.opends.server.types.DirectoryException;<br>
</span><span style="font-family: monospace;"><span
 style="color: rgb(153, 0, 0);">import</span> </span><span
 style="font-family: monospace;">org.opends.server.types.Entry;<br>
</span><span style="font-family: monospace;"><span
 style="color: rgb(153, 0, 0);">import</span> </span><span
 style="font-family: monospace;">org.opends.server.types.Attribute;<br>
</span><span style="font-family: monospace;"><span
 style="color: rgb(153, 0, 0);">import</span> </span><span
 style="font-family: monospace;">org.opends.server.types.InitializationException;<br>
</span><span style="font-family: monospace;"><span
 style="color: rgb(153, 0, 0);">import</span> </span><span
 style="font-family: monospace;">org.opends.server.types.ResultCode;<br>
</span><span style="font-family: monospace;"><span
 style="color: rgb(153, 0, 0);">import</span> </span><span
 style="font-family: monospace;">org.opends.server.types.operation.PreOperationAddOperation;<br>
</span><span style="font-family: monospace;"><span
 style="color: rgb(153, 0, 0);">import</span> </span><span
 style="font-family: monospace;">org.opends.server.types.AttributeType;<br>
</span><span style="font-family: monospace;"><span
 style="color: rgb(153, 0, 0);">import</span> </span><span
 style="font-family: monospace;">org.opends.server.types.DirectoryConfig;<br>
<br>
<span style="color: rgb(0, 0, 153);">/**</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;* This example is used to
demonstrate how to write a plugin example for openDs.</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;*/</span><br>
<span style="color: rgb(153, 0, 0);">public</span> <span
 style="color: rgb(153, 0, 0);">class</span> DescriptionLengthCheck
extends DirectoryServerPlugin<br>
{<br>
<span style="color: rgb(0, 153, 0);">&nbsp; // Used to efficiently
store the reference to the description</span><br
 style="color: rgb(0, 153, 0);">
<span style="color: rgb(0, 153, 0);">&nbsp; // attribute Type.</span><br
 style="color: rgb(0, 153, 0);">
<span style="color: rgb(0, 153, 0);">&nbsp; // This variable is
initialized when the plugin is loaded and used</span><br
 style="color: rgb(0, 153, 0);">
<span style="color: rgb(51, 204, 0);"><span
 style="color: rgb(0, 153, 0);">&nbsp; // during the pre-operation phase</span>.</span><br>
&nbsp; <span style="color: rgb(153, 0, 0);">private </span>AttributeType
descriptionAttrType = null;<br>
<br>
&nbsp; <span style="color: rgb(0, 102, 0);">// This
PreOperationPluginResult variable is used to</span><br
 style="color: rgb(0, 102, 0);">
<span style="color: rgb(0, 102, 0);">&nbsp; // indicate to the server
to stop processing the</span><br style="color: rgb(0, 102, 0);">
<span style="color: rgb(0, 102, 0);">&nbsp; // Operation and to return
the result now.</span><br>
&nbsp; <span style="color: rgb(153, 0, 0);">private static</span> <span
 style="color: rgb(153, 0, 0);">final</span> PreOperationPluginResult
STOP_RESULT =<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
new PreOperationPluginResult(false, false, true);<br>
<br>
&nbsp; <span style="color: rgb(0, 0, 153);">/**</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; * Performs any
initialization necessary for this plugin.&nbsp; This will</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; * be called as soon
as the plugin has been loaded and before it is</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; * registered with the
server.</span><br style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; *</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; * @param&nbsp;
pluginTypes&nbsp; The set of plugin types that indicate the</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp;
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ways in which this plugin will be invoked.</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; * @param&nbsp;
configEntry&nbsp; The entry containing the configuration</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp;
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
information for this plugin.</span><br style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; *</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; * @throws&nbsp;
ConfigException&nbsp; If the provided entry does not contain</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp;
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
a valid configuration for this plugin.</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; *</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; * @throws&nbsp;
InitializationException&nbsp; If a problem occurs while</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp;
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
initializing the plugin that is</span><br style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp;
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
not related to the server</span><br style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp;
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
configuration.</span><br style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; */</span><br>
&nbsp; <span style="color: rgb(153, 0, 0);">public void</span>
initializePlugin(Set pluginTypes, ConfigEntry configEntry)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(153, 0, 0);">throws</span>
ConfigException, InitializationException<br>
&nbsp; {<br>
&nbsp;&nbsp;&nbsp; descriptionAttrType =
DirectoryConfig.getAttributeType("description", true);<br>
&nbsp; }<br>
<br>
<br>
&nbsp; <span style="color: rgb(0, 0, 153);">/**</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; * Performs any
necessary processing that should be done just before</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; * the Directory
Server performs the core processing for an add</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; * operation.</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; * This method is not
called when processing synchronization</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; * operations.</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; *</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; * @param&nbsp;
addOperation&nbsp; The add operation to be processed.</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; *</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; * @return&nbsp;
Information about the result of the plugin processing.</span><br
 style="color: rgb(0, 0, 153);">
<span style="color: rgb(0, 0, 153);">&nbsp;&nbsp; */</span><br>
&nbsp; <span style="color: rgb(153, 0, 0);">public</span>
PreOperationPluginResult<br>
&nbsp;&nbsp;&nbsp; doPreOperation(PreOperationAddOperation addOperation)<br>
&nbsp; {<br>
&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 153, 0);">// get the
List of values for the description attribute</span><br>
&nbsp;&nbsp;&nbsp; Entry entryToAdd = addOperation.getEntryToAdd();<br>
&nbsp;&nbsp;&nbsp; List&lt;Attribute&gt; attributes =
entryToAdd.getAttribute(descriptionAttrType);<br>
<br>
<span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; // If there are
no description values then accept the ADD operation.</span><br>
&nbsp;&nbsp;&nbsp; <span style="color: rgb(153, 0, 0);">if</span>
(attributes == null)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(153, 0, 0);">return</span>
PreOperationPluginResult.SUCCESS;<br>
<br>
<span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; // Check that
all the values of the description attribute have at least</span><br
 style="color: rgb(0, 153, 0);">
<span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp; // 8 characters.</span><br>
&nbsp;&nbsp;&nbsp; <span style="color: rgb(153, 0, 0);">try</span><br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(153, 0, 0);">for</span>
(Attribute attr : attributes)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
 style="color: rgb(153, 0, 0);">for</span> (AttributeValue value :
attr.getValues())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
 style="color: rgb(153, 0, 0);">if</span>
(value.getNormalizedStringValue().length() &lt; 8)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
 style="color: rgb(0, 153, 0);">&nbsp; // This value is shorter than 8
characters.</span><br style="color: rgb(0, 153, 0);">
<span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// Set the result code of the operation to error condition</span><br
 style="color: rgb(0, 153, 0);">
<span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// and add an errors message.</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
addOperation.setResultCode(ResultCode.<span
 style="color: rgb(0, 0, 153);">CONSTRAINT_VIOLATION</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
addOperation.appendErrorMessage(<span style="color: rgb(0, 0, 153);">"description
is too short"</span>);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
 style="color: rgb(0, 153, 0);">// Indicate to the server to stop
processing the Operation</span><br style="color: rgb(0, 153, 0);">
<span style="color: rgb(0, 153, 0);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// and to return the result now.</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
 style="color: rgb(153, 0, 0);">return</span> STOP_RESULT;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp; <span style="color: rgb(153, 0, 0);">catch</span>
(DirectoryException de)<br>
&nbsp;&nbsp;&nbsp; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 153, 0);">//
continue with next value</span><br>
&nbsp;&nbsp;&nbsp; }<br>
<br>
&nbsp;&nbsp;&nbsp; <span style="color: rgb(0, 153, 0);">// All values
have been checked as correct.</span><br>
&nbsp;&nbsp;&nbsp; <span style="color: rgb(153, 0, 0);">return</span>
PreOperationPluginResult.<span style="color: rgb(0, 0, 153);">SUCCESS</span>;<br>
&nbsp; }<br style="font-family: monospace;">
</span><span style="font-family: monospace;">}</span>
<br>
<hr noshade="noshade" size="1">
<h1>How to test</h1>
<br>
<br>
<h2>Install OpenDS Directory Server</h2>
The most user-friendly way is to use the <a
 href="https://opends.dev.java.net/public/docs/user-docs/QuickSetup-guide.html">QuickSetup</a>
via Java web start.<br>
Alternatively follow instructions from the <a
 href="https://opends.dev.java.net/public/downloads_index.html">OpenDS
download page</a>.<br>
<br>
<h2>Build the plugin<br>
</h2>
Save the code above into a file named DescriptionLengthCheck.java in an
org/opends/plugins
directory<br>
compile the java code using command <span
 style="font-family: monospace;">javac -classpath
&lt;opends_install_dir&gt;/lib/OpenDS.jar DescriptionLengthCheck.java </span>(requires
a Java 5 or
superior version JDK installed and configured in the user environment).<br>
<br>
<span style="font-weight: bold;"></span>
<h2>Enable the plugin in OpenDS Directory Server daemon.</h2>
To enable a plugin in OpenDS it is currently necessary to stop the
server. This will be modified in the future so that&nbsp; plugins can
be
dynamically loaded.<br>
Stop OpenDS using the script <span style="font-family: monospace;">&lt;opends_install_dir&gt;/bin/stop-ds
(UNIX) or </span><span style="font-family: monospace;">opends_install_dir&gt;\bin\stop-ds.bat
(Windows)<br>
<br>
</span>Copy the <span style="font-family: monospace;">DescriptionLengthCheck.class</span>
file to
<span style="font-family: monospace;">&lt;opends_install_dir&gt;/class/org/example/opends/plugins/
</span>directory. All class files in the classes directory are
automatically included in the CLASSPATH and may be referenced in the
server configuration.<br>
<br>
Add the following entry in the OpenDS configuration file (<span
 style="font-family: monospace;">&lt;opends_install_dir&gt;/config/config.ldif</span>)&nbsp;
below the cn=Plugins,cn=config" entry :<br>
<br>
<span style="font-family: monospace;">dn:
cn=Description Length Check,cn=Plugins,cn=config</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">objectClass: top</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">objectClass: ds-cfg-plugin</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">cn: </span><span
 style="font-family: monospace;">Description Length Check</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">ds-cfg-plugin-class:
org.example.opends.plugins.DescriptionLengthCheck</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">ds-cfg-plugin-enabled: true</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">ds-cfg-plugin-type:
preOperationAdd</span><br>
<br>
This entry activates the DescriptionLengthCheck plugin inside
the OpenDS Server JVM.<br>
The <span style="font-family: monospace;">ds-cfg-plugin-class </span>attribute
contains the fully-qualified object class name of the plugin.<br>
The <span style="font-family: monospace;">ds-cfg-plugin-type </span>multivalued
attribute contains the list of plugin types implemented by this class.
Use multiple values if several types of plugin are implemented.<br>
<br>
Start the OpenDS server.<br>
<br>
<h2>Test the plugin.</h2>
Using your favorite LDAP client application, add an entry containing a
description attribute with a very short value.<br>
For example use :<br>
<span style="font-family: monospace;">&lt;opends_install_dir&gt;/bin/</span><span
 style="font-family: monospace;">ldapmodify -a&nbsp; -p
&lt;port_number&gt;</span><br style="font-family: monospace;">
<span style="font-family: monospace;">dn: cn=user,dc=example,dc=com</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">objectclass: inetOrgPerson<br>
cn: user<br>
<span style="font-family: monospace;">sn: surname</span></span><br
 style="font-family: monospace;">
<span style="font-family: monospace;"><span
 style="font-family: monospace;"><span style="font-family: monospace;">description:
short</span><br style="font-family: monospace;">
<span style="font-family: monospace;">^D</span><br>
</span><br>
</span><br>
The ADD operation should fail with Constraint violation (19) error and
with additional info: description is too short<br>
<br>
Using your favorite LDAP client application, add an entry containing a
description attribute with a longer value.<br>
For example use :<br>
<span style="font-family: monospace;">&lt;opends_install_dir&gt;/bin/</span><span
 style="font-family: monospace;">ldapmodify -a&nbsp; -p
&lt;port_number&gt;</span><br>
<span style="font-family: monospace;">dn: cn=user,dc=example,dc=com</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">objectclass: inetOrgPerson<br>
cn: user<br style="font-family: monospace;">
</span><span style="font-family: monospace;">sn: surname</span><br
 style="font-family: monospace;">
<span style="font-family: monospace;">description: description for user<br>
^D<br>
</span><br>
The ADD operation should now succeed.<br>
<hr noshade="noshade" size="1">
<h1>Other types of plugins</h1>
The DirectoryServerPlugin abstract class described in this document
also makes it possible to run custom code at many other times in the
life cycle of
a client request (pre- parse, pre-operation, post-operation,
post-response, ...) and also at various time of the server life cycle
(LDIF export , LDIF import, startup, shutdown, search result
entry,&nbsp; post-connect, post-disconnect, ...)<br>
<br>
OpenDS has been built to be even more extensible by providing many
other interfaces or abstract classes that can be used to extend the
behavior of the server. For example by extending the
org.opends.server.api.PasswordValidator class it is possible to write a
custom password validator plugins or by extending the
org.opends.server.api.PasswordGenerator class it is possible to write a
custom password generator.<br>
<br>
<hr noshade="noshade" size="1">
<a href="../index.html#How_To">OpenDS How To section</a><br>
<br>
</body>
</html>
